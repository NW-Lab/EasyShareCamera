# 回路図詳細

## 基本回路

### Arduino Uno / Nano 使用時

```
                        Arduino Uno/Nano
                       ┌──────────────────┐
                       │                  │
                       │              5V  ├─────┬─── フォトカプラ VCC
                       │                  │     │
                       │             GND  ├─────┼─── フォトカプラ GND
                       │                  │     │
                       │              D2  ├─────┴─── フォトカプラ OUT
                       │        (INPUT)   │           (プルアップ有効)
                       │                  │
                       │             D13  ├───────── 内蔵LED
                       │      (内蔵LED)   │
                       │                  │
                       │              D9  ├────┬──── 外部赤色LED (アノード)
                       │          (PWM)   │    │
                       │                  │   LED
                       │             GND  ├────┴─[220Ω]─ LED (カソード)
                       │                  │
                       └──────────────────┘
```

## フォトカプラモジュール詳細

### 一般的なフォトカプラモジュール（TCRT5000など）

```
フォトカプラモジュール
┌─────────────────────────┐
│                         │
│   [赤外線LED]  [受光部]  │
│       │          │      │
│      ↓↓↓        │      │
│       │          ↓      │
│                         │
│  VCC  GND  OUT  (調整)  │
└───┬───┬────┬────────────┘
    │   │    │
    │   │    └─────── Arduino D2
    │   └──────────── Arduino GND
    └──────────────── Arduino 5V
```

### 動作原理

1. 通常時：赤外線LEDの光が受光部に届く → OUT = HIGH
2. 水滴通過時：光が遮られる → OUT = LOW
3. Arduino側でLOW信号を検知してトリガー

## LED回路詳細

### 内蔵LED（D13）

Arduino Unoの内蔵LEDは抵抗内蔵のため、追加部品不要。

```
D13 ──[内蔵抵抗]── LED ── GND
```

### 外部赤色LED（D9）

より明るいLEDを使用する場合：

```
D9 (PWM) ────┬──── LED (アノード+)
             │
            LED (5mm 赤色高輝度)
             │
             └──── LED (カソード-)
                    │
                  [220Ω]
                    │
                   GND
```

#### 抵抗値の計算

- 電源電圧：5V
- LED順方向電圧：2.0V（赤色LED典型値）
- LED電流：20mA（最大）

```
R = (Vs - Vf) / If
R = (5V - 2V) / 0.02A
R = 150Ω

安全マージンを考慮して 220Ω を使用
```

### 複数LED並列接続（オプション）

撮影領域全体を照らす場合：

```
         ┌─── LED1 ─[220Ω]─┐
         │                  │
D9 ──────┼─── LED2 ─[220Ω]─┼─── GND
         │                  │
         └─── LED3 ─[220Ω]─┘

注意：各LEDに個別の抵抗が必要
```

## 電源供給

### USB給電

最も簡単な方法。PCまたはUSB充電器から給電。

```
USB ──── Arduino ──── 5V出力 ──── フォトカプラ/LED
```

### 外部電源（推奨）

複数LEDを使用する場合や、より安定した動作のため：

```
                    Arduino
                   ┌─────────┐
9V電池 ─[DCジャック]┤ VIN     │
  または            │         │
ACアダプタ          │     5V  ├─── フォトカプラ/LED
                   │         │
                   │    GND  ├─── GND
                   └─────────┘
```

推奨電源：
- 9V 1A ACアダプタ
- または 7-12V バッテリー

## 配線のヒント

### ブレッドボード配線例

```
     a b c d e   f g h i j
   ┌─────────────────────┐
 1 │ ● ● ● ● ●   ● ● ● ● │  ← 5V レール
   ├─────────────────────┤
 2 │ ● ● ● ● ●   ● ● ● ● │
 3 │ ● ● ● ● ●   ● ● ● ● │  ← フォトカプラ
 4 │ ● ● ● ● ●   ● ● ● ● │
   ├─────────────────────┤
 5 │ ● ● ● ● ●   ● ● ● ● │
 6 │ ● ● ● ● ●   ● ● ● ● │  ← LED + 抵抗
 7 │ ● ● ● ● ●   ● ● ● ● │
   ├─────────────────────┤
 8 │ ● ● ● ● ●   ● ● ● ● │  ← GND レール
   └─────────────────────┘
```

### ジャンパーワイヤーの色分け（推奨）

- **赤**: 5V（電源）
- **黒**: GND（グランド）
- **黄**: 信号線（D2）
- **緑**: 信号線（D9）

## 実装例の写真説明

### 配置イメージ

```
┌─────────────────────────────────────┐
│                                     │
│  [Arduino]  ─── USB ─── PC/充電器   │
│     │                               │
│     ├─── [フォトカプラ]              │
│     │        │                      │
│     │        └─── 水滴検知位置       │
│     │                               │
│     └─── [赤色LED] ─── 撮影領域照明  │
│                                     │
└─────────────────────────────────────┘
```

## 安全上の注意

1. **電源電圧**: Arduino Unoは5V動作、VINには7-12Vを供給
2. **電流制限**: LEDには必ず抵抗を直列接続
3. **極性**: LEDの向きに注意（アノード+、カソード-）
4. **短絡防止**: 配線時は電源を切る
5. **静電気**: 部品に触れる前に金属に触れて放電

## トラブルシューティング

### LEDが点灯しない

- 極性を確認（アノードとカソードが逆になっていないか）
- 抵抗値を確認（220Ω前後）
- 配線の接触を確認

### フォトカプラが反応しない

- VCC、GND、OUTの配線を確認
- フォトカプラの向きを確認
- シリアルモニタで信号を確認（HIGH/LOW）

### 常にトリガーされる

- フォトカプラの光軸を確認
- 環境光の影響を確認
- プルアップ抵抗の設定を確認（INPUT_PULLUP）

## 参考資料

- [Arduino公式リファレンス](https://www.arduino.cc/reference/en/)
- [フォトカプラの使い方](https://www.arduino.cc/en/Tutorial/BuiltInExamples)
- [PWMの使い方](https://www.arduino.cc/en/Tutorial/Foundations/PWM)
