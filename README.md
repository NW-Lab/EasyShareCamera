# EasyMeasurementCamera

ミルククラウン撮影用の240fpsスローモーションカメラアプリ + Arduinoトリガーシステム

## 概要

EasyMeasurementCameraは、水滴が液面に落下して形成される「ミルククラウン」を、赤色LEDトリガーを使って自動的に240fpsのスローモーションで撮影するシステムです。

**システム構成:**
- **iPhoneアプリ**: 赤色LED検知で自動録画（240fps）
- **Arduinoトリガー**: フォトカプラで水滴検知、赤色LED点灯

## 特徴

- **自動トリガー撮影**: 赤色LEDを検知すると自動的に録画を開始
- **240fps高速撮影**: iPhone標準のスローモーション機能を使用
- **物理計算に基づいた設定**: 30cm落下の水滴に最適化されたタイミング
- **シンプルなUI**: ワンタップで撮影準備完了
- **Arduino連携**: フォトカプラで確実な水滴検知

## 技術仕様

| 項目 | 値 |
|---|---|
| 落下高さ | 30cm |
| 落下時間 | 約247ms |
| フレームレート | 240fps |
| 録画時間 | 4秒 |
| 総フレーム数 | 960フレーム |
| 検知方式 | 赤色LED光学検知 |
| トリガー | フォトカプラ（Arduino） |

## システム全体の動作フロー

```
1. 水滴が30cm上の位置を通過
   ↓
2. フォトカプラが検知（Arduino）
   ↓
3. 赤色LEDが点灯（Arduino）
   ↓
4. iPhoneが赤色を検知
   ↓
5. 240fps録画開始（iPhone）
   ↓
6. 約247ms後に水滴が液面に到達
   ↓
7. ミルククラウンが形成される
   ↓
8. 4秒後に録画自動停止
   ↓
9. 写真ライブラリに保存
```

## セットアップ

### 1. iPhoneアプリ

#### システム要件

- iOS 17.0以降
- 240fps撮影対応のiPhone（iPhone 8以降）
- カメラとフォトライブラリへのアクセス許可

#### インストール

1. Xcodeでプロジェクトを開く
2. 開発チームを設定
3. iPhoneにビルド＆インストール

詳細は [DEVELOPMENT.md](DEVELOPMENT.md) を参照。

### 2. 水滴供給システム

水滴を安定して供給するために、2つの方式を提供しています：

#### 方式1: 自然落下（マリオット瓶 + 点滴セット）

- **特徴**: シンプル、プログラミング不要
- **コスト**: 約1,200円
- **推奨用途**: 最初のテスト、学習用

#### 方式2: 電磁弁制御

- **特徴**: 高精度、柔軟な制御
- **コスト**: 約4,000〜4,700円
- **推奨用途**: イベント、高度な撮影

詳細は [docs/WATER_SYSTEM_GUIDE.md](docs/WATER_SYSTEM_GUIDE.md) を参照。

### 3. Arduinoトリガーシステム

#### 必要な部品

- Arduino Uno / Nano（またはESP32）
- フォトカプラモジュール（TCRT5000など）
- 高輝度赤色LED
- 抵抗 220Ω
- ブレッドボードとジャンパーワイヤー

#### セットアップ

1. 回路を組み立て（[arduino/CIRCUIT.md](arduino/CIRCUIT.md) 参照）
2. Arduino IDEでコードをアップロード（[arduino/README.md](arduino/README.md) 参照）
3. フォトカプラを水滴検知位置（30cm上）に設置
4. 赤色LEDを撮影領域に配置

詳細は [arduino/README.md](arduino/README.md) を参照。

## 使い方

### 1. ハードウェアセットアップ

1. **カメラの固定**
   - iPhoneを三脚に固定
   - ミルククラウンが発生する位置を画面中央に合わせる

2. **フォトカプラの設置**
   - 水滴が通過する位置（30cm上）に配置
   - 光軸を正確に合わせる

3. **赤色LEDの配置**
   - iPhoneのカメラから見える位置に配置
   - 画面中央に映るように調整

4. **電源投入**
   - ArduinoをUSBまたは外部電源で起動
   - LEDが3回点滅すれば正常起動

### 2. 撮影手順

1. iPhoneアプリを起動
2. 「撮影準備」ボタンをタップ
3. 水滴を落とす
4. 自動的に録画開始
5. 4秒後に自動停止し、写真ライブラリに保存

### 3. 結果確認

撮影した動画は自動的に写真アプリに保存されます。スローモーション再生で美しいミルククラウンの形成過程を観察できます。

## 推奨環境

- **撮影環境**: 暗めの室内（赤色LEDを明確に検知するため）
- **照明**: 赤色以外の光源を使用（白色LED推奨）
- **LEDの配置**: 画面中央に配置し、カメラから見えるようにする
- **カメラ固定**: 三脚必須（手持ち撮影は非推奨）

## 物理的な仕組み

### 落下時間の計算

30cmの高さから水滴が落下する時間は、自由落下の式で計算できます：

```
t = √(2h/g)
t = √(2 × 0.3 / 9.81)
t ≈ 0.247秒（247ms）
```

### タイミング制御

1. 水滴が30cm上の位置で検知される
2. フォトカプラが信号を送信（Arduino）
3. 赤色LEDが点灯（Arduino）
4. iPhoneが赤色を検知（約10-20ms）
5. 録画開始
6. 約247ms後に水滴が液面に到達
7. ミルククラウンが形成される

240fpsで撮影することで、この一瞬の現象を約60フレームで捉えることができます。

## トラブルシューティング

### フォトカプラが反応しない

- 光軸がずれていないか確認
- 水滴のサイズを大きくする
- フォトカプラの感度を調整

### 赤色LEDが検知されない

- 撮影環境を暗くする
- LEDをより明るいものに変更
- LEDを画面中央に配置
- 他の赤い光源を取り除く

### 録画が開始されない

- カメラへのアクセス許可を確認
- アプリを再起動
- iPhoneを再起動

### ミルククラウンが映っていない

- カメラの位置を調整
- 落下高さを確認（30cmに設定）
- 水滴のサイズを調整

## プロジェクト構成

```
EasyMeasurementCamera/
├── EasyMeasurementCamera/          # iPhoneアプリ
│   ├── CameraManager.swift
│   ├── RedLightDetector.swift
│   ├── ContentView.swift
│   └── ...
├── docs/                    # ドキュメント
│   ├── WATER_SYSTEM_GUIDE.md
│   └── MARIOTTE_BOTTLE_GUIDE.md
├── arduino/                  # Arduinoトリガーシステム
│   ├── water_drop_trigger/
│   │   └── water_drop_trigger.ino
│   ├── README.md
│   └── CIRCUIT.md
├── README.md                 # このファイル
└── DEVELOPMENT.md            # 開発ガイド
```

## 開発情報

### iPhoneアプリ

- **言語**: Swift
- **フレームワーク**: SwiftUI, AVFoundation, Core Image
- **最小バージョン**: iOS 17.0

詳細は [DEVELOPMENT.md](DEVELOPMENT.md) を参照。

### Arduinoシステム

- **対応ボード**: Arduino Uno, Nano, ESP32
- **言語**: C/C++ (Arduino)
- **主要機能**: デジタル入力、PWM出力、シリアル通信

詳細は [arduino/README.md](arduino/README.md) を参照。

## 今後の拡張案

1. **複数台同期撮影**
   - Wi-Fiマルチキャストでトリガー信号を送信
   - 複数のiPhoneで同時撮影

2. **落下高さの可変設定**
   - UIで落下高さを設定可能に
   - 録画タイミングを自動計算

3. **検知パラメータのUI調整**
   - 設定画面で閾値を調整可能に
   - リアルタイムプレビューで確認

4. **ESP32 Wi-Fi連携**
   - より確実なトリガー方式
   - 複数デバイスの同期制御

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 作者

EasyMeasurementCamera開発チーム

## 謝辞

このシステムは、物理現象の教育用撮影を目的として開発されました。ミルククラウンの美しい瞬間を多くの人に共有できることを願っています。

## 参考資料

- [Arduino公式サイト](https://www.arduino.cc/)
- [Apple AVFoundation Documentation](https://developer.apple.com/documentation/avfoundation)
- [高速度撮影の基礎](https://ja.wikipedia.org/wiki/高速度撮影)
